(function(){var copyElement=null;function htmlEntities(string){return String(string).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function tagExists(input,tag){var tagList=input.val().split(input.attr("data-delimiter"));return tagList.indexOf(tag)>-1}function loadTags(settings,input,tagString){input.val("");$("#"+input.attr("id")+"_tagInputWidget .tag").remove();var tagList=tagString.split(input.attr("data-delimiter"));for(var i=0;i<tagList.length;i++)addTag(settings,input,tagList[i],false);return input}function addTag(settings,input,value,focus){value=value.trim();if(value.length){var sourceTags=value.split(input.attr("data-delimiter")),tagList=input.val().split(input.attr("data-delimiter")),tagInput=$("#"+input.attr("id")+"_tagInput");if(tagList[0]=="")tagList=new Array;for(var i=0;i<sourceTags.length;i++){value=sourceTags[i];if(tagExists(input,value)){if(sourceTags.length===0)tagInput.addClass("invalidTag")}else{tagInput.removeClass("invalidTag").val("");$(settings.tagHTML.replace(/\{value\}/g,htmlEntities(value))).insertBefore(tagInput);if(focus)tagInput.focus();else tagInput.blur();tagList.push(value);input.val(tagList.join(input.attr("data-delimiter")))}}}}function removeTag(settings,input,value){var delimiter=input.attr("data-delimiter"),old=input.val().split(delimiter),idx=old.indexOf(value);if(idx>-1){old.splice(idx,1);loadTags(settings,input,old.join(delimiter))}}$.fn.extend({setTags:function(tagString){return loadTags(this,tagString)},enableTagInput:function(options){var settings=$.extend({tagHTML:'<div class="chip tag"><span class="tagValue">{value}</span><i class="tagDelete">x</i></div>',widgetHTML:'<div id="{id}_tagInputWidget" class="tagInputWidget">'+'<input id="{id}_tagInput" class="tagInput" value="" placeholder="{placeholder}" />'+"</div>"},options);return this.each(function(){var $el=$(this),id=$el.attr("id"),delimiter=$el.attr("data-delimiter");if($el.attr("data-init-done"))return;$el.attr("data-init-done","1").hide();$(settings.widgetHTML.replace(/\{id\}/g,id).replace(/\{placeholder\}/g,$el.attr("data-placeholder"))).insertAfter($el);loadTags(settings,$el,$el.val());$("#"+id+"_tagInputWidget").on("click",function(event){if($(event.target).closest(".tagDelete").length){event.preventDefault();removeTag(settings,$el,$(event.target).closest(".tag").find(".tagValue").text())}else{$("#"+id+"_tagInput").focus()}});$("#"+id+"_tagInput").on("blur",function(event){addTag(settings,$el,$("#"+id+"_tagInput").val(),true)}).on("keydown",function(event){var $this=$(this);$this.removeClass("invalidTag");if(event.key==="Enter"||event.key===delimiter){event.preventDefault();addTag(settings,$el,$this.val(),true)}else if(event.key==="Backspace"&&$this.val()===""){event.preventDefault();removeTag(settings,$el,$this.closest(".tagInputWidget").find(".tag").last().find(".tagValue").text());$this.focus()}else if((event.ctrlKey||event.metaKey)&&event.key==="c"){if($this.val().length===0){event.preventDefault();if(!copyElement){copyElement=$('<textarea style="position:absolute; left:-9999px; top:0">');$("body").append(copyElement)}copyElement.val($el.val()).focus()[0].setSelectionRange(0,copyElement.val().length);try{document.execCommand("copy")}catch(e){}$this.focus()}}})})}})})();